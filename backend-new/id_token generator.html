<!DOCTYPE html>
<html>
<head>
  <meta charset="UTF-8">
  <title>id_token Generator</title>
  <script src="https://www.gstatic.com/firebasejs/9.6.10/firebase-app-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/9.6.10/firebase-auth-compat.js"></script>
</head>
<body>
  <h2>Firebase id_token Generator</h2>

  <div>
    <input id="phone-number" type="tel" value="+919999999999">
    <button id="send-otp-btn">Send OTP</button>
    <div id="recaptcha-container"></div>
  </div>

  <div>
    <input id="otp" type="text" value="000000" disabled>
    <button id="verify-otp-btn" disabled>Verify & Get Token</button>
  </div>

  <div id="status"></div>
  <div id="token-output" style="font-family: monospace; word-break: break-all;"></div>

  <script>
    const firebaseConfig = {
      apiKey: "AIzaSyD1ioNepFLiP3NumtZhRcz14y2qtl48U-A",
      authDomain: "shopsmartgmx.firebaseapp.com",
      projectId: "shopsmartgmx",
      storageBucket: "shopsmartgmx.firebasestorage.app",
      messagingSenderId: "126261083662",
      appId: "1:126261083662:web:ae573b553cb06d5dd2065f"
    };

    firebase.initializeApp(firebaseConfig);
    const auth = firebase.auth();

    const phoneInput = document.getElementById('phone-number');
    const otpInput = document.getElementById('otp');
    const sendOtpBtn = document.getElementById('send-otp-btn');
    const verifyOtpBtn = document.getElementById('verify-otp-btn');
    const tokenOutput = document.getElementById('token-output');
    const statusDiv = document.getElementById('status');

    function setStatus(msg) { statusDiv.textContent = msg; }

    function setupRecaptcha() {
      window.recaptchaVerifier = new firebase.auth.RecaptchaVerifier('recaptcha-container', { size: 'invisible' });
    }

    sendOtpBtn.onclick = () => {
      setupRecaptcha();
      setStatus("Sending OTP...");
      auth.signInWithPhoneNumber(phoneInput.value, window.recaptchaVerifier)
        .then(conf => {
          window.confirmationResult = conf;
          otpInput.disabled = false;
          verifyOtpBtn.disabled = false;
          setStatus("OTP sent.");
        })
        .catch(err => setStatus("Error: " + err.message));
    };

    verifyOtpBtn.onclick = () => {
      setStatus("Verifying...");
      confirmationResult.confirm(otpInput.value)
        .then(res => res.user.getIdToken())
        .then(token => {
          tokenOutput.textContent = token;
          setStatus("Token generated.");
        })
        .catch(err => setStatus("Error: " + err.message));
    };
  </script>
</body>
</html>
